#!/bin/sh

DIR=~/code/git/dotfiles
osx_keybindings(){
    if [ ! -d ~/Library/KeyBindings ]; then
	mkdir ~/Library/KeyBindings
    fi

    cat > ~/Library/KeyBindings/DefaultKeyBinding.dict <<EOF
{
  "^ " = setMark:;
  "^/" = undo:;
  "^u" = deleteToBeginningOfParagraph:;
  "^w" = deleteToMark:;
  "^x" = {
    "^x" = swapWithMark:;
    "^m" = selectToMark:;
  };
  "^V" = pageDownAndModifySelection:;
  "~@" = selectWord:;
  "~b" = moveWordBackward:;
  "~c" = (capitalizeWord:, moveForward:, moveForward:);
  "~d" = deleteWordForward:;
  "~f" = moveWordForward:;
  "~l" = (lowercaseWord:, moveForward:, moveForward:);
  "~u" = (uppercaseWord:, moveForward:, moveForward:);
  "~v" = pageUp:;
  "~w" = (deleteToMark:, setMark:, yank:, swapWithMark:);
  "~B" = moveWordBackwardAndModifySelection:;
  "~F" = moveWordForwardAndModifySelection:;
  "~V" = pageUpAndModifySelection:;
}
EOF
    echo "OS X keybindings applied"
}

emacs_terminfo() {
    EMACS_PATH=/Applications/Emacs.app
    if [[ -d $EMACS_PATH ]]; then
	echo "Installing Emacs terminfo"
	tic -x $(find $EMACS_PATH -name '*.ti')
    fi
}

symlinker() {
    echo "Symlinking dotfiles"
    for dot in $(ls dots) ; do
	if [ -z ~/.$dot ] || [ -d ~/.$dot ]; then
	    rm -rf ~/.$dot
	fi
	ln -sf $DIR/dots/$dot ~/.$dot
    done

    echo "You're all set!"
}

osx_keybindings
emacs_terminfo
symlinker
exit $?
